<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pms.dataService.dao.UnitSubjectInciteDao">
   <select id="getEsiSubjectAnalysisList_yx"  parameterType="java.util.Map" resultMap="unitSubjectIncite1">
        SELECT ceId, wosFwNum, wosCiteNum, highCitedNum, hotPaperNum
        FROM(
	        SELECT d.communityId ceId, COUNT(d.itemId) wosFwNum, SUM(d.cites) wosCiteNum, SUM(d.highCited) highCitedNum, SUM(d.hotPaper) hotPaperNum
			FROM
			(
				SELECT t.subject subject, t.cites cites, it.item_id itemId, ci.community_id communityId, (CASE it.IsHighCited WHEN 'Y' THEN 1 ELSE 0 END) highCited, (CASE it.IsHotPaper WHEN 'Y' THEN 1 ELSE 0 END) hotPaper
				FROM unit_subject_incite t, item it, community2item ci 
				WHERE t.wosnumber = it.fileName 
				AND it.item_id = ci.item_id 
				AND t.version_num = #{versionNum} 
				AND t.subject = #{subject} 
			) d 
			GROUP BY d.communityId 
		) cg 
		order by wosFwNum DESC
   </select>
   
   <select id="getEsiSubjectAnalysisList_xz"  parameterType="java.util.Map" resultMap="unitSubjectIncite1">
      SELECT ceId, wosFwNum, wosCiteNum, highCitedNum, hotPaperNum
        FROM(
            SELECT d.epersonId ceId, COUNT(d.itemId) wosFwNum, SUM(d.cites) wosCiteNum, SUM(d.highCited) highCitedNum, SUM(d.hotPaper) hotPaperNum
            FROM
            (
                SELECT t.subject subject, t.cites cites, it.item_id itemId, ci.epersonId epersonId, (CASE it.IsHighCited WHEN 'Y' THEN 1 ELSE 0 END) highCited, (CASE it.IsHotPaper WHEN 'Y' THEN 1 ELSE 0 END) hotPaper
                FROM unit_subject_incite t, item it, itembyauthor ci 
                WHERE t.wosnumber = it.fileName 
                AND it.item_id = ci.item_id 
                AND t.version_num = #{versionNum} 
                AND t.subject = #{subject}
            ) d 
            GROUP BY d.epersonId 
        ) cg 
        order by wosFwNum DESC
   </select>
   
</mapper>