<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pms.dataService.dao.ItemDao">
 <select id="query" parameterType="java.util.Map" resultMap="Item">
      select * from item
      <trim prefix="WHERE" prefixOverrides="AND|OR">
        <if test="itemId != NULL">
          and item_id = #{itemId}
        </if>
        <if test="contentType != NULL">
          and contenttype_id = #{contentType}
        </if>
        <if test="importMark != null">
          <choose>
             <when test="importMark instanceof Integer">
                and import_mark = #{importMark, jdbcType=INTEGER}
             </when>
             <when test="importMark instanceof java.util.List and importMark.size() > 0">
                and import_mark in
                <foreach collection="importMark" item="mark" open="(" close=")" separator=",">
                  #{mark}
                </foreach>
             </when>
          </choose>
        </if>
        <if test="itemIdList != null and itemIdList.size() > 0">
          
              and item_id in
              <foreach collection="itemIdList" item="itemId" open="(" close=")" separator=",">
                #{itemId}
              </foreach>
        </if>
        <if test="fileName != null and fileName != ''">
             and fileName = #{fileName}      
        </if>
        
        and isDelete = 0
      </trim>
   </select>
    <select id="getCommunities" parameterType="java.lang.Integer"
      resultType="java.lang.Integer">
      SELECT community.community_id FROM community, community2item
      <where>
         community.`status` >= 0 and community2item.community_id = community.community_id AND
         community2item.item_id = #{0} AND community2item.resource_type = #{1}
      </where>
   </select>
   
   <update id="batchUpdateFirstDep" parameterType="java.util.List">
      UPDATE item i,itembyauthor ia SET i.isfirstdep=1
       WHERE i.item_id=ia.`item_id` AND i.internal = 1 AND ia.`author_index`=1;
   </update>
   <select id="queryNoCnkiFileName" resultMap="Item">
      SELECT `item_id`,  `fileName` FROM item
         WHERE isDelete = 0 and `import_mark` NOT IN (0,3) AND `fileName` IS NOT NULL
         AND (`cnkiFileName` IS NULL OR `cnkiFileName` NOT LIKE '%CNKI%')
         AND `contenttype_id` IN (1,2,3,4,5,6,7,14)
   </select>
</mapper>